(function(n){if(typeof define=="function"&&define.amd)define(["jquery"],n);else if(typeof exports=="object")n(require("jquery"));else{if(typeof jQuery=="undefined")throw"repeater requires jQuery to be loaded first";n(jQuery)}})(function(n){function i(t,i){function s(n,t){return t.toLowerCase()}var u=n(t).data(),f={},e,o=new RegExp("^"+i.toLowerCase()+"([A-Z])"),r;i=new RegExp("^"+i.toLowerCase());for(r in u)u.hasOwnProperty(r)&&i.test(r)&&(e=r.replace(o,s),f[e]=u[r]);return f}var t=function(t,i){var f={},c,e,r,l,h=!1,s=function(){return e.find("> tr")},o=function(n){t.trigger(n)},u=function(){for(var r,u=[],f=s(),e,i,t=0;t<f.length;t++)e=n(f[t]).find('*[name*="]["]'),i={},n.each(e,function(t,u){var f=u.name.indexOf("]")+1,o=u.name.indexOf("]",f),e,s;f!==-1&&o!==-1&&(e=u.name.substring(f+1,o),r=n(this).attr("type"),r==="radio"?n(this).prop("checked")&&(i[e]=n(this).val()):(s=r==="checkbox"?n(this).prop("checked")?1:0:n(this).val(),i[e]=s))}),u.push(i);return l.val(JSON.stringify(u)),h?o({type:"save"}):o({type:"initialised"}),!0},b=function(t,i){var r=/\[\]/,u;n.each(n(t).find("input, select"),function(t,i){if(i.id!==""){var r=n.find('label[for="'+i.id+'"], button[for="'+i.id+'"]');i.id=i.id+"_"+Math.floor(Math.random()*1e7);n(r).attr("for",i.id)}});u=n(t).find('input[type="radio"]');n.each(u,function(t,u){var f=n.find('label[for="'+u.id+'"], button[for="'+u.id+'"]');u.name.match(r)===null?u.name+="["+i+"]":(u.name=u.name.replace(r,"["+i+"]"),u.name+="[]");u.id+="_"+t;n(f).attr("for",u.id)})},k=function(t){t.find("select").removeClass("chzn-done").show();t.find(".chzn-container").remove();n("select").chosen({disable_search_threshold:5,allow_single_deselect:!1});try{t.find(".fmtoggle").bootstrapToggle()}catch(i){}try{t.find(".fmtouchspin").TouchSpin()}catch(i){}try{t.find(".fmdatetimepicker").datetimepicker();t.on("dp.change",".fmdatetimepicker",function(){u()}.bind(this))}catch(i){}try{t.find('select[class^="fm-chzn-states"], select[class*=" fm-chzn-states"]').statesselect()}catch(i){}try{t.find(".fmradio").radio()}catch(i){}try{t.find(".hasTooltip").tooltip()}catch(i){}try{t.find(".minicolors").each(function(){n(this).minicolors({control:"hue",position:"right",theme:"bootstrap",change:function(){u()}})})}catch(i){}},a=function(t){return n(t).remove(),r!=undefined&&r.hasClass("disabled")&&r.removeClass("disabled").addClass("btn-success"),o({type:"rowRemoved",row:n(t)}),u(),!0},v=function(t,f){var l,v;if(i.maximum&&s().length>=i.maximum)return!1;l=c.clone();f?l.prependTo(e):l.appendTo(e);r!=undefined&&i.maximum&&s().length===i.maximum-1&&r.removeClass("btn-success").addClass("disabled");b(l,s().length);v=Object.keys(t);n.each(v,function(i,r){l.find('*[name*="['+r+']"]').each(function(i,u){var e=n(u).attr("type"),f=t[r];e==="checkbox"?f===1&&n(u).prop("checked",!0):e==="radio"?f===n(u).val()&&(n(u).prop("checked",!0),n(u).trigger("change")):(n(u).val(f),n(u).prop("tagName")==="SELECT"&&n(u).trigger("liszt:updated"))})});k(l);i.canremove&&l.find("*[data-repeater-remove-button]").click(function(t){var i=n(t.target).closest("tr");return i.length>0?a(i):!1}.bind(this));l.on("change",'*[name*="]["]',function(){o({type:"rowChanged",row:n(this).closest("tr")});u()}.bind(this));return h?o({type:"rowAdded",row:l}):o({type:"rowInitialized",row:l}),u(),l},y=function(n){v(n,i.addInFirst)},p=function(){return s().remove(),r!=undefined&&r.hasClass("disabled")&&r.removeClass("disabled").addClass("btn-success"),u(),!0},w=function(t){var r,u,f;for(p(),r=n.map(t,function(n){return[n]}),u=0;u<r.length;u++)f=r[u],v(f,!1);i.values=r};if(f.addRow=y,f.removeRow=a,f.save=u,f.reset=p,f.setValues=w,h=!1,e=t.find("tbody").first(),e.length===0)throw"Repeater element must have a tbody item.";return c=e.find("tr").first().clone(),r=t.find("*[data-repeater-add-button]").size()===0?t.find(".btn.btn-success"):t.find("*[data-repeater-add-button]"),t.find("*[data-repeater-save]").size()===0&&t.append('<input type="hidden" value="" data-repeater-save />'),l=t.find("*[data-repeater-save]"),t.find("tbody tr").first().remove(),i.canadd&&r.click(function(){return y(i.defaultValues)}.bind(this)),w(i.values),h=!0,f};n.fn.repeater=function(r){return this.each(function(){var u=n(this),f;u.data("Repeater")||(f=i(this,"repeater"),r=n.extend(!0,{},n.fn.repeater.defaults,f,r),u.data("Repeater",t(u,r)))})};n.fn.repeater.defaults={maximum:!1,addInFirst:!0,canadd:!0,canremove:!0,defaultValues:{},values:{}}});