(function(n){n(document).ready(function(){function o(t){var i=t==="1"?"2":"1",r=t;n('input[type="checkbox"][name="jform[withdraw'+i+']"]').bootstrapToggle("off");n('input[name="jform[score'+r+']"]').val(0);n('input[name="jform[score'+i+']"]').val(3);n('input[type="checkbox"][name="jform[extra_time]"]').bootstrapToggle("off");n('input[name="jform[penalties'+i+']"]').val(0);n('input[name="jform[penalties'+r+']"]').val(0);n('input[name="jform[bonus'+r+']"]').val(-1);n('input[name="jform[bonus'+i+']"]').val(0);n('select[name="jform[state]"]').val(1).trigger("liszt:updated")}function v(){n('input[name="jform[score1]"], input[name="jform[score2]"], input[name="jform[penalties1]"], input[name="jform[penalties2]"]').on("change",function(){n('select[name="jform[state]"]').val(1).trigger("liszt:updated")});n('input[name="jform[withdraw1]"]').on("change",function(){n(this).prop("checked")&&o("1")});n('input[name="jform[withdraw2]"]').on("change",function(){n(this).prop("checked")&&o("2")})}function s(t,i){i>0?(n("#fm-match-players"+t).hide(),n("#fm-match-tactic"+t).show()):(n("#fm-match-players"+t).show(),n("#fm-match-tactic"+t).hide())}function h(t){var i=n(t).find('input[name *="[state]"][value="0"]'),r=n(t).find('input[name *="[state]"][value="3"]');i.prop("checked")?n(t).find('input[name*="[state]"]').closest("td").nextAll("td").find("> div").hide():(n(t).find('input[name*="[state]"]').closest("td").nextAll("td").find("> div").show(),r.prop("checked")&&n(t).find('input[name*="[captain]"]').closest("td").find("> div").hide())}function y(u,e){var o;if(!f){if(o=t,i[u]>0&&e!==i[u]&&!confirm("Etes vous sur de vouloir modifier la tactique ? Vous perdrez les modifications sur la tactique actuelle.")){f=!0;FM.setValue('select[name="jform[tactic'+u+'_id]"]',i[u]);f=!1;return}if(i[u]=e,s(u,e),e>0){var h={id:e},c=function(t){n("#jform_firstTeamPlayers"+u+"_tacticeditor").data("TacticEditor").setReadOnlyPositions(t);o||n("#jform_firstTeamPlayers"+u+"_tacticeditor").data("TacticEditor").setValues([])},l=function(){t=!1};FM.loadAjaxData("getTacticPositions",h,c,"#fm-teams",l)}else r("#jform_playersStatistics"+u+"_personstable","#jform_players"+u+"_personstable")}}function p(t,i){n("#jform_firstTeamPlayers"+t+"_tacticeditor table tbody label").each(function(t,r){i.data("captain")===1&&i.attr("for")!==n(r).attr("for")&&n(r).data("captain",0);(n(r).data("captain")===0||n(r).data("captain")==undefined)&&n(r).closest("td").find(".fm-tactic-captain").remove()});i.data("captain")===1&&i.find(".fm-tactic-captain").length===0&&n('<span class="fm-tactic-captain" title="Capitaine"><i class="fa fa-certificate"><\/i><\/span>').insertAfter(i);n("#jform_firstTeamPlayers"+t+"_tacticeditor table tbody .fm-tactic-captain").tooltip()}function w(i){t=!0;var r=n("#jform_id").val(),u=n("#jform_team"+i+"_id").val(),f={match_id:r,team_id:u},e=function(t){var e=t.tactic?t.tactic:"0",o,s,r,u,f,h;if(n('select[name="jform[tactic'+i+'_id]"]').val(e).trigger("liszt:updated"),n('select[name="jform[tactic'+i+'_id]"]').trigger("change"),t.players.length)if(e>0)o=n.grep(t.players,function(n){return n.state===2||n.state===1}),s=n.grep(t.players,function(n){return n.state===3}),n("#jform_firstTeamPlayers"+i+"_tacticeditor").data("TacticEditor").setValues(o),n("#jform_substitutes"+i+"_repeater").data("Repeater").setValues(s);else for(n("#jform_players"+i+'_personstable tr:not(.fm-row-all) input[name*="[state]"][value="0"]').prop("checked",!0).trigger("change"),n("#jform_players"+i+'_personstable tr:not(.fm-row-all) input[name*="[captain]"]').bootstrapToggle("off"),n("#jform_players"+i+'_personstable tr:not(.fm-row-all) input[name*="[number]"]').val(""),r=0;r<t.players.length;r++)u=n("#jform_players"+i+'_personstable input[name*="[person_id]"][value="'+t.players[r].person_id+'"]').closest("tr"),u.find('input[name*="[state]"][value="'+t.players[r].state+'"]').prop("checked",!0).trigger("change"),t.players[r].captain===1&&u.find('input[name*="[captain]"]').bootstrapToggle("on"),u.find('input[name*="[number]"]').val(t.players[r].number);if(t.staff.length)for(n("#jform_staff"+i+'_personstable tr:not(.fm-row-all) input[name*="[state]"][value="0"]').prop("checked",!0).trigger("change"),f=0;f<t.staff.length;f++)h=n("#jform_staff"+i+'_personstable input[name*="[person_id]"][value="'+t.staff[f].person_id+'"]').closest("tr"),h.find('input[name*="[state]"][value="1"]').prop("checked",!0).trigger("change")},o=function(){t=!1};FM.loadAjaxData("getPreviousMatchTactic",f,e,"#fm-teams",o)}function b(i){t=!0;var r=n("#jform_call_up_id").val(),u={call_up_id:r},f=function(t){var r,f,u,e;if(t.players.length)for(n('select[name="jform[tactic'+i+'_id]"]').val(0).trigger("liszt:updated"),n('select[name="jform[tactic'+i+'_id]"]').trigger("change"),n("#jform_players"+i+'_personstable tr:not(.fm-row-all) input[name*="[state]"][value="0"]').prop("checked",!0).trigger("change"),n("#jform_players"+i+'_personstable tr:not(.fm-row-all) input[name*="[captain]"]').bootstrapToggle("off"),n("#jform_players"+i+'_personstable tr:not(.fm-row-all) input[name*="[number]"]').val(""),r=0;r<t.players.length;r++)f=n("#jform_players"+i+'_personstable input[name*="[person_id]"][value="'+t.players[r].person_id+'"]').closest("tr"),f.find('input[name*="[state]"][value="1"]').prop("checked",!0).trigger("change");if(t.staff.length)for(n("#jform_staff"+i+'_personstable tr:not(.fm-row-all) input[name*="[state]"][value="0"]').prop("checked",!0).trigger("change"),u=0;u<t.staff.length;u++)e=n("#jform_staff"+i+'_personstable input[name*="[person_id]"][value="'+t.staff[u].person_id+'"]').closest("tr"),e.find('input[name*="[state]"][value="1"]').prop("checked",!0).trigger("change")},e=function(){t=!1};FM.loadAjaxData("getCallUpPersons",u,f,"#fm-teams",e)}function e(t,i){var r=0;return n(t+" tr:not(.fm-row-all)").closest("tr").find('td[data-title="'+i+'"] input').each(function(){var t=n(this).val()===""?0:n(this).val();r+=parseInt(t)}),r}function u(t){n(t+' tr.fm-row-all input[name *="statistic"]').each(function(){var i=n(this).closest("td").attr("data-title");n(this).val(e(t,i))})}function r(t,i){n(t+" tbody tr:not(.fm-row-all)").each(function(){var t=n(this).find('input[name*="[person_id]"]').val();n(i+' tbody tr input[name*="[person_id]"][value="'+t+'"]').closest("tr").find('input[name *="[state]"][value="0"]').prop("checked")?(n(this).find('input[name *="person_id"]').closest("td").nextAll("td").find("input").val(""),n(this).hide()):n(this).show()});u(t)}function c(t,i){n("#jform_playersStatistics"+t+"_personstable tbody tr:not(.fm-row-all)").each(function(){var r=n(this).find('input[name*="[person_id]"]').val(),u=n("#jform_substitutes"+t+'_repeater select[name*="[person_id]"] option[value="'+r+'"]:selected').length>0,f=n("#jform_firstTeamPlayers"+t+"_tacticeditor_save").val().indexOf('"person_id":"'+r+'"')>0;u||f?n(this).show():(i&&n(this).find('input[name *="person_id"]').closest("td").nextAll("td").find("input").val(""),n(this).hide())});u("#jform_playersStatistics"+t+"_personstable")}function l(t){i[t]=n('select[name="jform[tactic'+t+'_id]"]').val();s(t,i[t]);n("#jform_staff"+t+"_personstable .fmradio").radio();n("#jform_staff"+t+"_personstable tr:not(.fm-row-all) .fmtouchspin").TouchSpin();n("#jform_staff"+t+"_personstable .fmtoggle").bootstrapToggle();n("#jform_staff"+t+"_personstable .hasTooltip").tooltip();n("#jform_staff"+t+"_personstable tbody tr:not(.fm-row-all)").each(function(){n(this).find('input[name *="[state]"]').on("change",function(){r("#jform_staffStatistics"+t+"_personstable","#jform_staff"+t+"_personstable")})});n("#jform_staff"+t+'_personstable tr.fm-row-all input[name *="[state]"]').on("change",function(){n(this).prop("checked")&&n("#jform_staff"+t+'_personstable tr:not(.fm-row-all) input[name *="[state]"][value="'+n(this).val()+'"]').prop("checked",!0).trigger("change")});n('table tr.fm-row-all *[name*="[all]"]').each(function(){n(this).attr("name",n(this).attr("name").replace("jform","all"))});n("#jform_players"+t+"_personstable .fmradio").radio();n("#jform_players"+t+"_personstable tr:not(.fm-row-all) .fmtouchspin").TouchSpin();n("#jform_players"+t+"_personstable .fmtoggle").bootstrapToggle();n("#jform_players"+t+"_personstable .hasTooltip").tooltip();n("#jform_players"+t+'_personstable tr.fm-row-all input[id *="_number"]').closest("td").find("div").hide();n("#jform_players"+t+'_personstable tr.fm-row-all input[id *="_captain"]').closest("td").find("div").hide();n("#jform_players"+t+'_personstable tr.fm-row-all span[id *="_goal"]').closest("td").find("div").hide();n("#jform_players"+t+"_personstable tr.fm-row-all .fm-addgoal").closest("td").find("div").hide();n("#jform_players"+t+'_personstable tr.fm-row-all input[name *="[state]"]').on("change",function(){n(this).prop("checked")&&n("#jform_players"+t+'_personstable tr:not(.fm-row-all) input[name *="[state]"][value="'+n(this).val()+'"]').prop("checked",!0).trigger("change")});n("#jform_players"+t+'_personstable tr:not(.fm-row-all) input[name *="[captain]"]').on("change",function(){n(this).prop("checked")&&n("#jform_players"+t+'_personstable tr:not(.fm-row-all) input[name *="[captain]"]:not(#'+n(this).prop("id")+")").bootstrapToggle("off")});n("#jform_players"+t+"_personstable tbody tr:not(.fm-row-all)").each(function(){h(n(this));n(this).find('input[name *="[state]"]').on("change",function(){h(n(this).closest("tr"));r("#jform_playersStatistics"+t+"_personstable","#jform_players"+t+"_personstable")})});n("#jform_players"+t+"_personstable tbody tr .fm-addgoal").on("click",function(i){var r=n(this).closest("tr").find('input[name *="[person_id]"]').val();n("#jform_goals"+t+"_repeater").data("Repeater").addRow({striker_id:r});i.preventDefault()});n('select[name="jform[tactic'+t+'_id]"]').on("change",function(){var i=n('select[name="jform[tactic'+t+'_id]"]').val();y(t,i)});n("#jform_firstTeamPlayers"+t+"_tacticeditor").on("positionUpdated",function(i){n('select[name="jform[tactic'+t+'_id]"]').val()>0&&p(t,i.label)});n('select[name="jform[tactic'+t+'_id]"]').val()>0&&c(t,!1);n("#jform_firstTeamPlayers"+t+"_tacticeditor, #jform_substitutes"+t+"_repeater").on("save",function(){n('select[name="jform[tactic'+t+'_id]"]').val()>0&&c(t,!0)});n("#team"+t+"-import-from-previous-match:not(.disabled)").on("click",function(){w(t)});n("#team"+t+"-import-from-call-up:not(.disabled)").on("click",function(){b(t)});n('select[name="jform[tactic'+t+'_id]"]').val()===""&&r("#jform_playersStatistics"+t+"_personstable","#jform_players"+t+"_personstable");n("#jform_playersStatistics"+t+"_personstable .fmradio").radio();n("#jform_playersStatistics"+t+"_personstable tr:not(.fm-row-all) .fmtouchspin").TouchSpin();n("#jform_playersStatistics"+t+"_personstable .fmtoggle").bootstrapToggle();n("#jform_playersStatistics"+t+"_personstable .hasTooltip").tooltip();n("#jform_playersStatistics"+t+'_personstable tr.fm-row-all input[id *="_statistic"]').attr("disabled","disabled");u("#jform_playersStatistics"+t+"_personstable");n("#jform_playersStatistics"+t+'_personstable tr:not(.fm-row-all) input[name *="statistic"]').on("change",function(){var i=n("#jform_playersStatistics"+t+'_personstable tr.fm-row-all td[data-title="'+n(this).closest("td").attr("data-title")+'"] input');i.val(e("#jform_playersStatistics"+t+"_personstable",n(this).closest("td").attr("data-title")))});r("#jform_staffStatistics"+t+"_personstable","#jform_staff"+t+"_personstable");n("#jform_staffStatistics"+t+"_personstable .fmradio").radio();n("#jform_staffStatistics"+t+"_personstable tr:not(.fm-row-all) .fmtouchspin").TouchSpin();n("#jform_staffStatistics"+t+"_personstable .fmtoggle").bootstrapToggle();n("#jform_staffStatistics"+t+"_personstable .hasTooltip").tooltip();n("#jform_staffStatistics"+t+'_personstable tr.fm-row-all input[name *="statistic"]').attr("disabled","disabled");u("#jform_staffStatistics"+t+"_personstable");n("#jform_staffStatistics"+t+'_personstable tr:not(.fm-row-all) input[name *="statistic"]').on("change",function(){var i=n("#jform_staffStatistics"+t+'_personstable tr.fm-row-all td[data-title="'+n(this).closest("td").attr("data-title")+'"] input');i.val(e("#jform_staffStatistics"+t+"_personstable",n(this).closest("td").attr("data-title")))})}var t=!1,i=[],a=!1,f=!1;v();l("1");l("2");a=!0})})(jQuery);